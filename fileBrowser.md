**برنامه‌ی کاوشگر فایل**

- **نویسنده**: احمد کنی
- **تاریخ**: ۱۹ بهمن ۱۴۰۳  
- **وضعیت**: پیش‌نویس/~~در حال بررسی~~/~~تایید شده~~

---
## **خلاصه**

این برنامه به عنوان یک برنامه‌ی نوشته شده با pure javascript و با استفاده از قابلیت‌های service worker و git، این امکان را به کاربر می‌دهد تا با استفاده از این کاوشگر فایل، اسناد را ایجاد، ویرایش و یا حذف کند.
این برنامه مانند یک native file explorer کار می‌کند و بدون اینکه کاربر را با قابلیت‌های git مواجه کند، امکان استفاده از قابلیت‌های git را به او می‌دهد.

---

## **سامانه‌ی فایل‌بندی**

برای این برنامه نیاز به استفاده از چند سامانه وجود دارد. اولین و اساسی‌ترین سامانه، سامانه‌ی فایل‌بندی یا file system است. این سامانه باید طوری باشد که بتواند به تنهایی و بدون هیچ وابستگی‌ای در محیط مرورگر کار کند.
این سامانه یک سامانه مشابه node fs است که فایل‌ها را طبقه‌بندی و در پایگاه داده‌ی indexed db ذخیره کند.

---

## **عملیات CRUD**

برای پیاده سازی عملیات CRUD در سیستم، آنها را به شکل زیر با ترکیب عملیات fs با عملیات git انجام می‌دهیم:
1. **ایجاد (*C*) :** در این عمل، کاربر می‌تواند دو نوع فایل و پوشه را ایجاد کند، همچنین این عملیات عمل‌های پایه‌ای برگرفته از isomorphic git هستند که بدون بازکردن مسیرها و پوشه‌ها می‌توان آن‌ها را استفاده کرد. 
		**(همچنین قابل ذکر است که برای احراز هویت کاربر و امضای دیجیتال و همچنین پی بردن به هویت شخص ایجادکننده‌ی فایل می‌توانیم از commit's author استفاده کنیم.)
	- برای ایجاد فایل از این سلسله عملیات استفاده می‌کنیم: 
		- Git.WriteFileOnDotGit(filePath)
		- Git.commit(commitMessage : File *A* Created by User *A* with IP Address *1.1.1.1*) 
	- برای ایجاد پوشه از این سلسله عملیات استفاده می‌کنیم:
		- Git.mkdirRecursively(dirPath)
		- Git.commit(commitMessage : directory */A* Created by User *A* with IP Address *1.1.1.1*)

2. **خواندن (*R*):** در این عمل، کاربر محتوای یک فایل یا پوشه را می‌خواند:
	- برای خواندن محتوای یک فایل از تک عمل Git.readFileFromDotGit استفاده می‌کنیم، این عمل با استفاده از توابع پایه‌ای isomorphic git مانند readBlob قابل پیاده‌سازی است و کارکرد آن به این صورت است که فایل را از آخرین commit انجام شده می‌خواند.
	- برای خواندن محتوای یک پوشه از عمل Git.listFilesFromDotGit استفاده می‌کنیم این عمل نیز با استفاده از دستورات پایه است و لیست فایل‌ها را بدن بازکردن و خواندن فایل‌ها و پوشه‌ها از طریق دسترسی به درخت‌های ایجاد شده توسط گیت لیست می‌کند.
	
3. **به‌روزرسانی (*U*):** دو مدل به روزرسانی وجود دارد که به ترتیب سلسله عملیات مربتط با هرکدام را نیز می‌گوییم، این عملیات عمل‌های پایه‌ای برگرفته از isomorphic git هستند که بدون بازکردن مسیرها و پوشه‌ها می‌توان آن‌ها را استفاده کرد:
	- به روزرسانی محتوای یک فایل: 
		- Git.WriteFileOnDotGit(filePath)
		- Git.commit(commitMessage : File *A* Updated by User *A* with IP Address *1.1.1.1*)
	- به روزرسانی نام یک فایل یا پوشه:
		- Git.rename(oldname, newname)
		- Git.commit(commitMessage : File *A* renamed by User *A* with IP Address *1.1.1.1*)

4. **حذف (*D*):** این عمل برای دو نوع فایل و پوشه قابل انجام است:
	- برای حذف یک فایل از این سلسله عملیات استفاده می‌کنیم:
		- Git.remove(filePath)
		- Git.commit(commitMessage : File *A* removed by User *A* with IP Address *1.1.1.1*)


	- برای حذف یک پوشه از این سلسله عملیات استفاده می‌کنیم:
		- Git.removeRecursively(filePath)
		- Git.commit(commitMessage : directory *A* removed by User *A* with IP Address *1.1.1.1*)

این سلسله عملیات ها توسط توابع مرتبط با آنها پیاده خواهند شد.

---

## **همگام‌سازی با ریموت**

برای همگام‌سازی داده‌ی محلی با داده‌ی ریموت چند گزینه در اختیار کاربر قرار می‌دهیم که می‌تواند از بین آنها یکی را برای استراتژی همگام‌سازی خود انتخاب کند:

5. همگام‌سازی دستی : به این صورت است که کاربر همگام‌سازی  را تنها هنگامی انجام می‌دهد که خودش بخواهد و همگام‌سازی خودکار انجام نمی‌شود.
6. همگام‌سازی زمان‌محور: در این حالت همگام‌سازی های بازه‌ای انجام می‌شود، به این صورت که کاربر تعیین می‌کند پس از بازه‌های زمانی مشخصی این همگام‌سازی‌ها انجام شود.
7. همگام‌سازی رخدادمحور: در این مدل کاربر تعیین می‌کند که همگام‌سازی  پس از رخداد خاصی انجام شود، مثلا هنگام خروج کاربر از برنامه، یا هنگام ورود.

این تنظیمات را باید در یک قسمت مشخص برای کاربر ایجاد کنیم و اجازه‌ی ویرایش آن را به کاربر بدهیم.
این تنظیمات در یک فایل خاص در پوشه‌ی .git برای کاربر ایجاد  و از آنجا خوانده می‌شود.
